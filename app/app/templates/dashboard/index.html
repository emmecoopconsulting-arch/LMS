{% extends 'base.html' %}
{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-end gap-2 mb-3">
  <div>
    <h2 class="page-title mb-1">Dashboard scadenze</h2>
    <p class="page-subtitle mb-0">Panoramica certificati scaduti e in scadenza.</p>
  </div>
  <a href="/certifications" class="btn btn-primary">Apri elenco certificazioni</a>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-6">
    <div class="card kpi border-danger-subtle">
      <div class="kpi-label">Certificati Scaduti</div>
      <div class="kpi-value text-danger">{{ expired }}</div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card kpi border-warning-subtle">
      <div class="kpi-label">In Scadenza Entro 30 Giorni</div>
      <div class="kpi-value text-warning">{{ expiring }}</div>
    </div>
  </div>
</div>

{% for days, items in upcoming %}
<div class="card mb-3">
  <div class="card-header">In scadenza nei prossimi {{ days }} giorni</div>
  <div class="table-responsive">
    <table class="table table-sm mb-0">
      <thead><tr><th>Dipendente</th><th>Certificazione</th><th>Tipo</th><th>Scadenza</th><th>Stato</th></tr></thead>
      <tbody>
        {% if items|length == 0 %}
        <tr><td colspan="5" class="text-center text-muted py-3">Nessuna certificazione in questa finestra temporale.</td></tr>
        {% endif %}
        {% for c in items %}
        {% set st = status_for_expiry(c.expiry_date) %}
        <tr>
          <td><a href="/employees/{{ c.employee.id }}">{{ c.employee.first_name }} {{ c.employee.last_name }}</a></td>
          <td>{{ c.title }}</td>
          <td>{{ c.cert_type }}</td>
          <td>{{ c.expiry_date }}</td>
          <td>
            <span class="badge badge-status {% if st=='expired' %}bg-danger{% elif st=='expiring' %}bg-warning text-dark{% else %}bg-success{% endif %}">
              {% if st == 'expired' %}Scaduto{% elif st == 'expiring' %}In scadenza{% else %}Valido{% endif %}
            </span>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endfor %}
{% endblock %}
