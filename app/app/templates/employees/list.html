{% extends 'base.html' %}
{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-end gap-2 mb-3">
  <div>
    <h2 class="page-title mb-1">Dipendenti</h2>
    <p class="page-subtitle mb-0">Elenco sincronizzato da Factorial con stato attivo/inattivo.</p>
  </div>
  {% if current_user.role == 'admin' %}
  <form method="post" action="/admin/sync" class="m-0">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <button class="btn btn-outline-primary">Sincronizza ora da Factorial</button>
  </form>
  {% endif %}
</div>

<div class="card mb-3">
  <div class="card-body">
    <form class="row g-2" method="get">
      <div class="col-md-4"><input class="form-control" name="q" placeholder="Ricerca per nome o email" value="{{ q }}"></div>
      <div class="col-md-3">
        <select class="form-select" name="location">
          <option value="">Tutte le sedi</option>
          {% for l in locations %}<option value="{{ l }}" {% if location==l %}selected{% endif %}>{{ l }}</option>{% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <select class="form-select" name="active">
          <option value="">Tutti gli stati</option>
          <option value="true" {% if active=='true' %}selected{% endif %}>Solo attivi</option>
          <option value="false" {% if active=='false' %}selected{% endif %}>Solo inattivi</option>
        </select>
      </div>
      <div class="col-md-2 d-flex gap-2">
        <button class="btn btn-primary w-100">Filtra</button>
        <a class="btn btn-light border" href="/employees">Reset</a>
      </div>
    </form>
  </div>
</div>

<div class="card">
  <div class="table-responsive">
    <table class="table align-middle mb-0">
      <thead><tr><th>Nome</th><th>Email</th><th>Sede</th><th>Centro di costo</th><th>Stato</th></tr></thead>
      <tbody>
        {% if employees|length == 0 %}
        <tr><td colspan="5" class="text-center text-muted py-3">Nessun dipendente trovato con i filtri correnti.</td></tr>
        {% endif %}
        {% for e in employees %}
        <tr>
          <td><a href="/employees/{{ e.id }}"><strong>{{ e.first_name }} {{ e.last_name }}</strong></a></td>
          <td>{{ e.email or '-' }}</td>
          <td>{{ e.location or '-' }}</td>
          <td>{{ e.cost_center or '-' }}</td>
          <td>{% if e.is_active %}<span class="badge bg-success badge-status">Attivo</span>{% else %}<span class="badge bg-secondary badge-status">Inattivo</span>{% endif %}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
